// https://github.com/arose/ngl/ LICENSE
var UI={Element:function(){}};
UI.Element.prototype={setId:function(a){this.dom.id=a;return this},setTitle:function(a){this.dom.title=a;return this},setClass:function(a){this.dom.className=a;return this},setStyle:function(a,b){for(var c=0;c<b.length;c++)this.dom.style[a]=b[c]},getStyle:function(a){return this.dom.style[a]},getBox:function(){return this.dom.getBoundingClientRect()},setDisabled:function(a){this.dom.disabled=a;return this},setTextContent:function(a){this.dom.textContent=a;return this},dispose:function(){this.dom.parentNode.removeChild(this.dom)}};
var properties="position left top right bottom width height border borderLeft borderTop borderRight borderBottom borderColor display overflow margin marginLeft marginTop marginRight marginBottom padding paddingLeft paddingTop paddingRight paddingBottom color backgroundColor opacity fontSize fontWeight fontStyle fontFamily textTransform cursor verticalAlign clear float zIndex minHeight maxHeight minWidth maxWidth wordBreak wordWrap spellcheck lineHeight whiteSpace textOverflow".split(" ");
properties.forEach(function(a){var b=a.substr(0,1).toUpperCase()+a.substr(1,a.length);UI.Element.prototype["set"+b]=function(){this.setStyle(a,arguments);return this};UI.Element.prototype["get"+b]=function(){return this.getStyle(a)}});var events="KeyUp KeyDown KeyPress MouseOver MouseOut Click Change Input".split(" ");events.forEach(function(a){UI.Element.prototype["on"+a]=function(b){this.dom.addEventListener(a.toLowerCase(),b.bind(this),!1);return this}});
UI.Panel=function(){UI.Element.call(this);var a=document.createElement("div");a.className="Panel";this.dom=a;return this};UI.Panel.prototype=Object.create(UI.Element.prototype);UI.Panel.prototype.add=function(){for(var a=0;a<arguments.length;a++)this.dom.appendChild(arguments[a].dom);return this};UI.Panel.prototype.remove=function(){for(var a=0;a<arguments.length;a++)this.dom.removeChild(arguments[a].dom);return this};
UI.Panel.prototype.clear=function(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild);return this};
UI.CollapsiblePanel=function(){UI.Panel.call(this);this.dom.className="Panel CollapsiblePanel";this.button=document.createElement("div");this.button.className="CollapsiblePanelButton";this.dom.appendChild(this.button);var a=this;this.button.addEventListener("click",function(b){a.toggle()},!1);this.content=document.createElement("div");this.content.className="CollapsibleContent";this.dom.appendChild(this.content);this.isCollapsed=!1;return this};UI.CollapsiblePanel.prototype=Object.create(UI.Panel.prototype);
UI.CollapsiblePanel.prototype.addStatic=function(){for(var a=0;a<arguments.length;a++)this.dom.insertBefore(arguments[a].dom,this.content);return this};UI.CollapsiblePanel.prototype.removeStatic=UI.Panel.prototype.remove;UI.CollapsiblePanel.prototype.clearStatic=function(){this.dom.childNodes.forEach(function(a){a!==this.content&&this.dom.removeChild(a)})};UI.CollapsiblePanel.prototype.add=function(){for(var a=0;a<arguments.length;a++)this.content.appendChild(arguments[a].dom);return this};
UI.CollapsiblePanel.prototype.remove=function(){for(var a=0;a<arguments.length;a++)this.content.removeChild(arguments[a].dom);return this};UI.CollapsiblePanel.prototype.clear=function(){for(;this.content.children.length;)this.content.removeChild(this.content.lastChild)};UI.CollapsiblePanel.prototype.toggle=function(){this.setCollapsed(!this.isCollapsed)};UI.CollapsiblePanel.prototype.collapse=function(){this.setCollapsed(!0)};UI.CollapsiblePanel.prototype.expand=function(){this.setCollapsed(!1)};
UI.CollapsiblePanel.prototype.setCollapsed=function(a){a?this.dom.classList.add("collapsed"):this.dom.classList.remove("collapsed");this.isCollapsed=a};UI.Text=function(a){UI.Element.call(this);var b=document.createElement("span");b.className="Text";b.style.cursor="default";b.style.display="inline-block";b.style.verticalAlign="middle";this.dom=b;this.setValue(a);return this};UI.Text.prototype=Object.create(UI.Element.prototype);
UI.Text.prototype.setValue=function(a){void 0!==a&&(this.dom.textContent=a);return this};UI.Input=function(){UI.Element.call(this);var a=document.createElement("input");a.className="Input";a.style.padding="2px";a.style.border="1px solid #ccc";a.addEventListener("keydown",function(a){a.stopPropagation()},!1);this.dom=a;return this};UI.Input.prototype=Object.create(UI.Element.prototype);UI.Input.prototype.getValue=function(){return this.dom.value};
UI.Input.prototype.setValue=function(a){this.dom.value=a;return this};UI.TextArea=function(){UI.Element.call(this);var a=document.createElement("textarea");a.className="TextArea";a.style.padding="2px";a.style.border="1px solid #ccc";a.addEventListener("keydown",function(a){a.stopPropagation()},!1);this.dom=a;return this};UI.TextArea.prototype=Object.create(UI.Element.prototype);UI.TextArea.prototype.getValue=function(){return this.dom.value};
UI.TextArea.prototype.setValue=function(a){this.dom.value=a;return this};UI.Select=function(){UI.Element.call(this);var a=document.createElement("select");a.className="Select";a.style.width="64px";a.style.height="16px";a.style.border="0px";a.style.padding="0px";this.dom=a;return this};UI.Select.prototype=Object.create(UI.Element.prototype);UI.Select.prototype.setMultiple=function(a){this.dom.multiple=a;return this};
UI.Select.prototype.setOptions=function(a){for(var b=this.dom.value;0<this.dom.children.length;)this.dom.removeChild(this.dom.firstChild);for(var c in a){var d=document.createElement("option");d.value=c;d.innerHTML=a[c];this.dom.appendChild(d)}this.dom.value=b;return this};UI.Select.prototype.getValue=function(){return this.dom.value};UI.Select.prototype.setValue=function(a){this.dom.value=a;return this};
UI.FancySelect=function(){UI.Element.call(this);var a=this,b=document.createElement("div");b.className="FancySelect";b.tabIndex=0;var c=document.createEvent("HTMLEvents");c.initEvent("change",!0,!0);b.addEventListener("keydown",function(a){switch(a.keyCode){case 38:case 40:a.preventDefault(),a.stopPropagation()}},!1);b.addEventListener("keyup",function(b){switch(b.keyCode){case 38:case 40:a.selectedIndex+=38==b.keyCode?-1:1,0<=a.selectedIndex&&a.selectedIndex<a.options.length&&(a.setValue(a.options[a.selectedIndex].value),
a.dom.dispatchEvent(c))}},!1);this.dom=b;this.options=[];this.selectedIndex=-1;this.selectedValue=null;return this};UI.FancySelect.prototype=Object.create(UI.Element.prototype);
UI.FancySelect.prototype.setOptions=function(a){var b=this,c=document.createEvent("HTMLEvents");for(c.initEvent("change",!0,!0);0<b.dom.children.length;)b.dom.removeChild(b.dom.firstChild);b.options=[];for(var d=0;d<a.length;d++){var e=a[d],f=document.createElement("div");f.className="option";f.innerHTML=e.html;f.value=e.value;b.dom.appendChild(f);b.options.push(f);f.addEventListener("click",function(a){b.setValue(this.value);b.dom.dispatchEvent(c)},!1)}return b};
UI.FancySelect.prototype.getValue=function(){return this.selectedValue};UI.FancySelect.prototype.setValue=function(a){for(var b=0;b<this.options.length;b++){var c=this.options[b];if(c.value===a){c.classList.add("active");var d=c.offsetTop-this.dom.offsetTop,c=d+c.offsetHeight-this.dom.offsetHeight;this.dom.scrollTop>d?this.dom.scrollTop=d:this.dom.scrollTop<c&&(this.dom.scrollTop=c);this.selectedIndex=b}else c.classList.remove("active")}this.selectedValue=a;return this};
UI.Checkbox=function(a){UI.Element.call(this);var b=document.createElement("input");b.className="Checkbox";b.type="checkbox";this.dom=b;this.setValue(a);return this};UI.Checkbox.prototype=Object.create(UI.Element.prototype);UI.Checkbox.prototype.getValue=function(){return this.dom.checked};UI.Checkbox.prototype.setValue=function(a){void 0!==a&&(this.dom.checked=a);return this};
UI.Color=function(){UI.Element.call(this);var a=document.createElement("input");a.className="Color";a.style.width="64px";a.style.height="16px";a.style.border="0px";a.style.padding="0px";a.style.backgroundColor="transparent";try{a.type="color",a.value="#ffffff"}catch(b){}this.dom=a;return this};UI.Color.prototype=Object.create(UI.Element.prototype);UI.Color.prototype.getValue=function(){return this.dom.value};UI.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)};
UI.Color.prototype.setValue=function(a){this.dom.value=a;return this};UI.Color.prototype.setHexValue=function(a){this.dom.value="#"+("000000"+a.toString(16)).slice(-6);return this};
UI.Number=function(a){UI.Element.call(this);var b=this,c=document.createElement("input");c.className="Number";c.value="0.00";c.addEventListener("keydown",function(a){a.stopPropagation();13===a.keyCode&&c.blur()},!1);this.min=-Infinity;this.max=Infinity;this.precision=2;this.step=1;this.dom=c;this.setValue(a);var d=document.createEvent("HTMLEvents");d.initEvent("change",!0,!0);var e=0,f=0,g=[0,0],h=[0,0],l=function(a){var k=c.value;g=[a.clientX,a.clientY];e+=g[0]-h[0]-(g[1]-h[1]);var n=50;a.shiftKey&&
(n=5);a.ctrlKey&&(n=500);c.value=Math.min(b.max,Math.max(b.min,f+e/n*b.step)).toFixed(b.precision);k!==c.value&&c.dispatchEvent(d);h=[a.clientX,a.clientY]},k=function(a){document.removeEventListener("mousemove",l,!1);document.removeEventListener("mouseup",k,!1);2>Math.abs(e)&&(c.focus(),c.select())};c.addEventListener("mousedown",function(a){a.preventDefault();e=0;f=parseFloat(c.value);h=[a.clientX,a.clientY];document.addEventListener("mousemove",l,!1);document.addEventListener("mouseup",k,!1)},!1);
c.addEventListener("change",function(a){a=parseFloat(c.value);c.value=!1===isNaN(a)?a:0},!1);c.addEventListener("focus",function(a){c.style.backgroundColor="";c.style.borderColor="#ccc";c.style.cursor=""},!1);c.addEventListener("blur",function(a){c.style.backgroundColor="transparent";c.style.borderColor="transparent";c.style.cursor="col-resize"},!1);return this};UI.Number.prototype=Object.create(UI.Element.prototype);UI.Number.prototype.getValue=function(){return parseFloat(this.dom.value)};
UI.Number.prototype.setValue=function(a){void 0!==a&&(this.dom.value=a.toFixed(this.precision));return this};UI.Number.prototype.setRange=function(a,b){this.min=a;this.max=b;return this};UI.Number.prototype.setPrecision=function(a){this.precision=a;return this};
UI.Integer=function(a){UI.Element.call(this);var b=this,c=document.createElement("input");c.className="Number";c.value="0.00";c.addEventListener("keydown",function(a){a.stopPropagation()},!1);this.min=-Infinity;this.max=Infinity;this.step=1;this.dom=c;this.setValue(a);var d=document.createEvent("HTMLEvents");d.initEvent("change",!0,!0);var e=0,f=0,g=[0,0],h=[0,0],l=function(a){var k=c.value;g=[a.clientX,a.clientY];e+=g[0]-h[0]-(g[1]-h[1]);var n=50;a.shiftKey&&(n=5);a.ctrlKey&&(n=500);c.value=Math.min(b.max,
Math.max(b.min,f+e/n*b.step))|0;k!==c.value&&c.dispatchEvent(d);h=[a.clientX,a.clientY]},k=function(a){document.removeEventListener("mousemove",l,!1);document.removeEventListener("mouseup",k,!1);2>Math.abs(e)&&(c.focus(),c.select())};c.addEventListener("mousedown",function(a){a.preventDefault();e=0;f=parseFloat(c.value);h=[a.clientX,a.clientY];document.addEventListener("mousemove",l,!1);document.addEventListener("mouseup",k,!1)},!1);c.addEventListener("change",function(a){a=parseInt(c.value);!1===
isNaN(a)&&(c.value=a)},!1);c.addEventListener("focus",function(a){c.style.backgroundColor="";c.style.borderColor="#ccc";c.style.cursor=""},!1);c.addEventListener("blur",function(a){c.style.backgroundColor="transparent";c.style.borderColor="transparent";c.style.cursor="col-resize"},!1);return this};UI.Integer.prototype=Object.create(UI.Element.prototype);UI.Integer.prototype.getValue=function(){return parseInt(this.dom.value)};
UI.Integer.prototype.setValue=function(a){void 0!==a&&(this.dom.value=a|0);return this};UI.Integer.prototype.setRange=function(a,b){this.min=a;this.max=b;return this};UI.Break=function(){UI.Element.call(this);var a=document.createElement("br");a.className="Break";this.dom=a;return this};UI.Break.prototype=Object.create(UI.Element.prototype);UI.HorizontalRule=function(){UI.Element.call(this);var a=document.createElement("hr");a.className="HorizontalRule";this.dom=a;return this};
UI.HorizontalRule.prototype=Object.create(UI.Element.prototype);UI.Button=function(a){UI.Element.call(this);var b=document.createElement("button");b.className="Button";this.dom=b;this.dom.textContent=a;return this};UI.Button.prototype=Object.create(UI.Element.prototype);UI.Button.prototype.setLabel=function(a){this.dom.textContent=a;return this};
UI.MenubarHelper={createMenuContainer:function(a,b){var c=new UI.Panel,d=new UI.Panel;d.setClass("title");d.setTextContent(a);d.setMargin("0px");d.setPadding("8px");c.setClass("menu");c.add(d);c.add(b);return c},createOption:function(a,b,c){var d=new UI.Panel;d.setClass("option");c?(d.add((new UI.Icon(c)).setWidth("20px")),d.add(new UI.Text(a))):d.setTextContent(a);d.onClick(b);return d},createOptionsPanel:function(a){var b=new UI.Panel;b.setClass("options");a.forEach(function(a){b.add(a)});return b},
createInput:function(a,b){var c=(new UI.Panel).setClass("option"),d=(new UI.Text).setWidth("70px").setValue(a),e=(new UI.Input).setWidth("40px").onKeyDown(b);c.add(d);c.add(e);return c},createCheckbox:function(a,b,c){var d=(new UI.Panel).setClass("option");a=(new UI.Text).setWidth("70px").setValue(a);b=(new UI.Checkbox).setValue(b).onClick(c);d.add(b);d.add(a);return d},createDivider:function(){return new UI.HorizontalRule}};
UI.Html=function(a){UI.Element.call(this);var b=document.createElement("span");b.className="Html";b.style.cursor="default";b.style.display="inline-block";b.style.verticalAlign="middle";this.dom=b;this.setValue(a);return this};UI.Html.prototype=Object.create(UI.Element.prototype);UI.Html.prototype.setValue=function(a){void 0!==a&&(this.dom.innerHTML=a);return this};
UI.EllipsisText=function(a){UI.Text.call(this,a);this.setWhiteSpace("nowrap");this.setOverflow("hidden");this.setTextOverflow("ellipsis");return this};UI.EllipsisText.prototype=Object.create(UI.Text.prototype);UI.EllipsisText.prototype.setValue=function(a){void 0!==a&&(this.dom.textContent=a,this.setTitle(a));return this};
UI.EllipsisMultilineText=function(a){UI.Element.call(this);var b=document.createElement("span");b.className="EllipsisMultilineText";b.style.cursor="default";b.style.display="inline-block";b.style.verticalAlign="middle";var c=document.createElement("p");b.appendChild(c);this.dom=b;this.content=c;this.setValue(a);return this};UI.EllipsisMultilineText.prototype=Object.create(UI.Element.prototype);
UI.EllipsisMultilineText.prototype.setValue=function(a){void 0!==a&&(this.content.textContent=a,this.setTitle(a));return this};UI.OverlayPanel=function(){UI.Panel.call(this);this.dom.className="Panel OverlayPanel";this.dom.tabIndex=0;return this};UI.OverlayPanel.prototype=Object.create(UI.Panel.prototype);UI.OverlayPanel.prototype.attach=function(a){a=a||document.body;a.appendChild(this.dom);return this};
UI.Icon=function(a){UI.Panel.call(this);var b=document.createElement("span");b.className="Icon fa";this.dom=b;a&&this.addClass.apply(this,arguments);return this};UI.Icon.prototype=Object.create(UI.Panel.prototype);UI.Icon.prototype.hasClass=function(a){return this.dom.classList.contains("fa-"+a)};UI.Icon.prototype.addClass=function(a){for(var b=0;b<arguments.length;b++)this.dom.classList.add("fa-"+arguments[b]);return this};
UI.Icon.prototype.setClass=function(a){this.dom.className="Icon fa";for(var b=0;b<arguments.length;b++)this.dom.classList.add("fa-"+arguments[b]);return this};UI.Icon.prototype.removeClass=function(a){for(var b=0;b<arguments.length;b++)this.dom.classList.remove("fa-"+arguments[b]);return this};UI.Icon.prototype.switchClass=function(a,b){this.removeClass(b,a);this.addClass(a);return this};UI.ToggleIcon=function(a,b,c){UI.Icon.call(this,a?b:c);this.value=a;this.classTrue=b;this.classFalse=c;return this};
UI.ToggleIcon.prototype=Object.create(UI.Icon.prototype);UI.ToggleIcon.prototype.setValue=function(a){(this.value=a)?this.switchClass(this.classTrue,this.classFalse):this.switchClass(this.classFalse,this.classTrue);return this};UI.ToggleIcon.prototype.getValue=function(){return this.value};
UI.DisposeIcon=function(){UI.Icon.call(this,"trash-o");var a=!1,b=this;this.setTitle("delete");this.setCursor("pointer");this.onClick(function(){!0===a?"function"===typeof b.disposeFunction&&b.disposeFunction():(b.setColor("rgb(178, 34, 34)"),b.dom.classList.add("deleteInfo"),a=!0,setTimeout(function(){b.setColor("#888");b.dom.classList.remove("deleteInfo");a=!1},1500))});return this};UI.DisposeIcon.prototype=Object.create(UI.Icon.prototype);
UI.DisposeIcon.prototype.setDisposeFunction=function(a){this.disposeFunction=a;return this};UI.Progress=function(a,b){UI.Element.call(this);var c=document.createElement("progress");c.className="Progress";c.max=a||1;void 0!==b&&(c.value=b);this.dom=c;return this};UI.Progress.prototype=Object.create(UI.Element.prototype);UI.Progress.prototype.getValue=function(){return this.dom.value};UI.Progress.prototype.setValue=function(a){this.dom.value=a;return this};
UI.Progress.prototype.setMax=function(a){this.dom.max=a;return this};UI.Progress.prototype.setIndeterminate=function(){this.dom.removeAttribute("value");return this};UI.Range=function(a,b,c,d){UI.Element.call(this);var e=document.createElement("input");e.className="Range";e.type="range";e.min=a;e.max=b;e.value=c;e.step=d;this.dom=e;this.dom.textContent=c;this.onInput(function(){this.dom.setAttribute("value",this.getValue())});return this};UI.Range.prototype=Object.create(UI.Element.prototype);
UI.Range.prototype.getValue=function(){return this.dom.value};UI.Range.prototype.setRange=function(a,b){this.dom.min=a;this.dom.max=b;return this};UI.Range.prototype.setValue=function(a){this.dom.value=a;return this};UI.Range.prototype.setStep=function(a){this.dom.step=a;return this};
UI.AdaptiveTextArea=function(){UI.Element.call(this);var a=document.createElement("div");a.className="AdaptiveTextAreaContainer";var b=document.createElement("textarea");b.className="AdaptiveTextArea";var c=document.createElement("div");c.className="AdaptiveTextAreaSize";a.appendChild(b);a.appendChild(c);b.addEventListener("input",function(a){c.innerHTML=b.value+"\n"},!1);this.textarea=b;this.size=c;this.dom=a;return this};UI.AdaptiveTextArea.prototype=Object.create(UI.Element.prototype);
UI.AdaptiveTextArea.prototype.getValue=function(){return this.textarea.value};UI.AdaptiveTextArea.prototype.setValue=function(a){this.textarea.value=a;this.size.innerHTML=a+"\n";return this};UI.AdaptiveTextArea.prototype.setSpellcheck=function(a){this.textarea.spellcheck=a;return this};UI.AdaptiveTextArea.prototype.setBackgroundColor=function(a){this.textarea.style.backgroundColor=a;return this};
UI.VirtualList=function(a){UI.Element.call(this);var b=document.createElement("div");b.className="VirtualList";this.dom=b;this._items=a;this.list=new VirtualList({w:280,h:300,itemHeight:31,totalRows:a.length,generatorFn:function(b){var d=new UI.Panel;b=(new UI.Text).setColor("orange").setMarginLeft("10px").setValue("ITEM "+a[b]);d.add(b);return d.dom}});console.log(this.dom);console.log(this.list);this.dom.appendChild(this.list.container);return this};
UI.PopupMenu=function(a,b,c){c=c||"scrollParent";UI.Panel.call(this);var d=new UI.Icon(a||"bars"),e=(new UI.OverlayPanel).setDisplay("none").attach(this.dom);a=(new UI.Panel).setBorderBottom("1px solid #555").setMarginBottom("10px").setHeight("25px");a.add((new UI.Icon("times")).setFloat("right").setCursor("pointer").onClick(function(){this.setMenuDisplay("none")}.bind(this))).add(new UI.Text(b));e.add(a);var f;d.setTitle("menu");d.setCursor("pointer");d.onClick(function(a){"block"===e.getDisplay()?
(this.setMenuDisplay("none"),f.destroy()):(this.setMenuDisplay("block"),f=new Tether({element:e.dom,target:d.dom,attachment:"top right",targetAttachment:"top left",offset:"0px 5px",constraints:[{to:c,attachment:"element",pin:["top","bottom"]}]}),f.position())}.bind(this));this.add(d);this.setClass("").setDisplay("inline");this.icon=d;this.panel=e;this.entryLabelWidth="100px";return this};UI.PopupMenu.prototype=Object.create(UI.Panel.prototype);
UI.PopupMenu.prototype.addEntry=function(a,b){this.panel.add((new UI.Text(a)).setWidth(this.entryLabelWidth)).add(b||new UI.Panel).add(new UI.Break);return this};UI.PopupMenu.prototype.setEntryLabelWidth=function(a){this.entryLabelWidth=a;return this};UI.PopupMenu.prototype.setMenuDisplay=function(a){this.panel.setDisplay(a);"none"!==a&&this.panel.dom.focus();return this};UI.PopupMenu.prototype.setIconTitle=function(a){this.icon.setTitle(a);return this};
UI.PopupMenu.prototype.dispose=function(){this.panel.dispose();UI.Element.prototype.dispose.call(this)};
UI.CollapsibleIconPanel=function(a,b){UI.Panel.call(this);this.dom.className="Panel CollapsiblePanel";void 0===a&&(a=a||"chevron-right",b=b||"chevron-down");this.button=(new UI.Icon(a)).setTitle("expand/collapse").setCursor("pointer").setWidth("12px").setMarginRight("6px");this.addStatic(this.button);var c=this;this.button.dom.addEventListener("click",function(a){c.toggle()},!1);this.content=document.createElement("div");this.content.className="CollapsibleContent";this.dom.appendChild(this.content);
this.isCollapsed=!1;this.iconClass1=a;this.iconClass2=b;return this};UI.CollapsibleIconPanel.prototype=Object.create(UI.CollapsiblePanel.prototype);
UI.CollapsibleIconPanel.prototype.setCollapsed=function(a){a?(this.dom.classList.add("collapsed"),this.iconClass2?this.button.switchClass(this.iconClass2,this.iconClass1):this.button.addClass("rotate-90")):(this.dom.classList.remove("collapsed"),this.iconClass2?this.button.switchClass(this.iconClass1,this.iconClass2):this.button.removeClass("rotate-90"));this.isCollapsed=a};
UI.ColorPicker=function(){var a=this;UI.Panel.call(this);this.slideWrapper=(new UI.Panel).setClass("slide-wrapper");this.sliderIndicator=(new UI.Panel).setClass("slide-indicator");this.slider=(new UI.Panel).setClass("slide").setWidth("25px").setHeight("80px");this.slideWrapper.add(this.slider,this.sliderIndicator);this.pickerWrapper=(new UI.Panel).setClass("picker-wrapper");this.pickerIndicator=(new UI.Panel).setClass("picker-indicator");this.picker=(new UI.Panel).setClass("picker").setWidth("130px").setHeight("80px");
this.pickerWrapper.add(this.picker,this.pickerIndicator);var b=document.createEvent("Event");b.initEvent("change",!0,!0);this.add(this.pickerWrapper,this.slideWrapper);this.colorPicker=ColorPicker(this.slider.dom,this.picker.dom,function(c,d,e,f,g){!f&&g&&.05>d.s?(d.s=.5,d.v=.7,a.colorPicker.setHsv(d)):(ColorPicker.positionIndicators(a.sliderIndicator.dom,a.pickerIndicator.dom,g,f),a.hex=c,a.hsv=d,a.rgb=e,a._settingValue||a.dom.dispatchEvent(b))});this.colorPicker.fixIndicators(this.sliderIndicator.dom,
this.pickerIndicator.dom);return this};UI.ColorPicker.prototype=Object.create(UI.Panel.prototype);UI.ColorPicker.prototype.setValue=function(a){a!==this.hex&&(this._settingValue=!0,this.colorPicker.setHex(a),this._settingValue=!1);return this};UI.ColorPicker.prototype.getValue=function(){return this.hex};
UI.ColorPopupMenu=function(){var a=this;UI.Panel.call(this);this.iconText=(new UI.Text("")).setCursor("pointer").setClass("fa-stack-1x").setFontFamily("Arial, sans-serif").setColor("#111");this.iconSquare=new UI.Icon("square","stack-1x");this.menu=new UI.PopupMenu("stack","Color");this.menu.icon.setTitle("color").setWidth("1em").setHeight("1em").setLineHeight("1em").add(this.iconSquare).add(this.iconText);var b=document.createEvent("Event");b.initEvent("change",!0,!0);NGL.ColorFactory.signals.typesChanged.add(function(){this.schemeSelector.setOptions(NGL.ColorFactory.getTypes())},
this);this.schemeSelector=(new UI.Select).setColor("#444").setWidth("").setOptions(NGL.ColorFactory.getTypes()).onChange(function(){a.setScheme(a.schemeSelector.getValue());"color"!==a.schemeSelector.getValue()&&a.menu.setMenuDisplay("none");a.dom.dispatchEvent(b)});this.colorInput=(new UI.Input).onChange(function(){a.setScheme("color");a.setColor(a.colorInput.getValue());a.dom.dispatchEvent(b)});this.colorPicker=(new UI.ColorPicker).setDisplay("inline-block").onChange(function(c){a.setScheme("color");
a.setColor(a.colorPicker.getValue());a.dom.dispatchEvent(b)});this.menu.addEntry("Scheme",this.schemeSelector).addEntry("Input",this.colorInput).addEntry("Picker",this.colorPicker);this.add(this.menu);this.setClass("").setDisplay("inline");return this};UI.ColorPopupMenu.prototype=Object.create(UI.Panel.prototype);UI.ColorPopupMenu.prototype.setScheme=function(a){a=a||"";this.iconText.setValue(a.charAt(0).toUpperCase());this.schemeSelector.setValue(a);"color"!==a&&this.setColor("#888888");return this};
UI.ColorPopupMenu.prototype.getScheme=function(){return this.schemeSelector.getValue()};
UI.ColorPopupMenu.prototype.setColor=function(){var a=new THREE.Color;return function(b){a.set(b);b="#"+a.getHexString();this.colorInput.setBackgroundColor(b).setValue(b);this.colorPicker.setValue(b);this.iconSquare.setColor(b);130<Math.sqrt(255*a.r*a.r*61.455+255*a.g*a.g*255*.691+255*a.b*a.b*17.34)?(this.iconText.setColor("#000000"),this.colorInput.setColor("#000000")):(this.iconText.setColor("#FFFFFF"),this.colorInput.setColor("#FFFFFF"));return this}}();UI.ColorPopupMenu.prototype.getColor=function(){return this.colorInput.getValue()};
UI.ColorPopupMenu.prototype.getValue=function(){return this.colorInput.getValue()};UI.ColorPopupMenu.prototype.setValue=function(a){parseInt(a)===a?(this.setColor(a),this.setScheme("color")):this.setScheme(a);return this};UI.ColorPopupMenu.prototype.dispose=function(){this.menu.dispose();UI.Panel.prototype.dispose.call(this)};
UI.SelectionInput=function(a){UI.AdaptiveTextArea.call(this);this.setSpellcheck(!1);if(!(a instanceof NGL.Selection))return NGL.error("UI.SelectionInput: not a selection",a),this;this.setValue(a.string);this.selection=a;var b=this;a.signals.stringChanged.add(function(a){b.setValue(a)});this.onEnter();return this};UI.SelectionInput.prototype=Object.create(UI.AdaptiveTextArea.prototype);UI.SelectionInput.prototype.setValue=function(a){UI.AdaptiveTextArea.prototype.setValue.call(this,a);return this};
UI.SelectionInput.prototype.onEnter=function(a){var b=this;this.onKeyPress(function(c){var d=b.getValue(),e=String.fromCharCode(c.which);13===c.keyCode?(c.preventDefault(),(new NGL.Selection(d)).selection.error?b.setBackgroundColor("tomato"):("function"===typeof a?a(d):b.selection.setString(d),b.setBackgroundColor("white"))):b.selection.string!==d+e?b.setBackgroundColor("skyblue"):b.setBackgroundColor("white")});this.onKeyUp(function(a){a=b.getValue();(new NGL.Selection(a)).selection.error?b.setBackgroundColor("tomato"):
b.selection.string===b.getValue()?b.setBackgroundColor("white"):b.setBackgroundColor("skyblue")});return this};UI.SelectionPanel=function(a){UI.Panel.call(this);this.icon=(new UI.Icon("filter")).setTitle("filter selection").addClass("lg").setMarginRight("10px");this.input=new UI.SelectionInput(a);this.add(this.icon,this.input);return this};UI.SelectionPanel.prototype=Object.create(UI.Panel.prototype);UI.SelectionPanel.prototype.setInputWidth=function(a){this.input.setWidth(a);return this};
UI.ComponentPanel=function(a){UI.Panel.call(this);var b=a.stage,c=a.signals;c.nameChanged.add(function(a){d.setValue(NGL.unicodeHelper(a))});c.visibilityChanged.add(function(a){e.setValue(a)});c.disposed.add(function(){g.dispose()});var d=(new UI.EllipsisText(NGL.unicodeHelper(a.name))).setWidth("100px"),e=(new UI.ToggleIcon(a.visible,"eye","eye-slash")).setTitle("hide/show").setCursor("pointer").setMarginLeft("25px").onClick(function(){a.setVisibility(!a.visible)}),c=(new UI.Icon("bullseye")).setTitle("center").setCursor("pointer").setMarginLeft("10px").onClick(function(){a.centerView(!0)}),
f=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){b.removeComponent(a)}),g=(new UI.PopupMenu("bars",a.type)).setMarginLeft("46px").setEntryLabelWidth("110px");this.add(d,e,c,f,g);this.menu=g;return this};UI.ComponentPanel.prototype=Object.create(UI.Panel.prototype);UI.ComponentPanel.prototype.addMenuEntry=function(a,b){this.menu.addEntry(a,b);return this};UI.ComponentPanel.prototype.setMenuDisplay=function(a){this.menu.setMenuDisplay(a);return this};NGL.Widget=function(){};
NGL.Widget.prototype={constructor:NGL.Widget};
NGL.StageWidget=function(a){var b=a.signals,c=a.viewer;this.viewport=(new NGL.ViewportWidget(a)).setId("viewport");document.body.appendChild(this.viewport.dom);this.toolbar=(new NGL.ToolbarWidget(a)).setId("toolbar");document.body.appendChild(this.toolbar.dom);this.menubar=(new NGL.MenubarWidget(a)).setId("menubar");document.body.appendChild(this.menubar.dom);this.sidebar=(new NGL.SidebarWidget(a)).setId("sidebar");document.body.appendChild(this.sidebar.dom);b.requestTheme.add(function(a){a="light"===
a?"../css/light.css":"../css/dark.css";document.getElementById("theme").href=a});a.preferences.setTheme();c.onWindowResize();setTimeout(function(){c.onWindowResize()},500);return this};
NGL.ViewportWidget=function(a){var b=a.viewer,c=b.renderer,d=new UI.Panel;d.setPosition("absolute");b.container=d.dom;d.dom.appendChild(c.domElement);d.dom.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy"},!1);d.dom.addEventListener("drop",function(b){b.stopPropagation();b.preventDefault();b=b.dataTransfer.files;for(var c=b.length,d=0;d<c;++d)a.loadFile(b[d])},!1);return d};
NGL.ToolbarWidget=function(a){var b=a.signals,c=new UI.Panel,d=(new UI.Panel).setDisplay("inline").setFloat("left"),e=(new UI.Panel).setDisplay("inline").setFloat("right");b.atomPicked.add(function(a){var b="none";a&&(b=a.qualifiedName()+" ("+a.residue.chain.model.structure.name+")");d.clear().add(new UI.Text("Picked: "+b))});a.viewer.stats.signals.updated.add(function(){e.clear().add(new UI.Text(a.viewer.stats.lastDuration+" ms | "+a.viewer.stats.lastFps+" fps"))});c.add(d);return c};
NGL.MenubarWidget=function(a){var b=new UI.Panel;b.add(new NGL.MenubarFileWidget(a));b.add(new NGL.MenubarViewWidget(a));b.add(new NGL.MenubarExamplesWidget(a));b.add(new NGL.MenubarHelpWidget(a));b.add((new UI.Panel).setClass("menu").setFloat("right").add((new UI.Text("NGL Viewer "+NGL.REVISION)).setClass("title")));return b};
NGL.MenubarFileWidget=function(a){var b="pdb ent gro cif mcif mmcif sdf mol2 mrc ccp4 map cube obj ply ngl ngz gz lzma bz2 zip".split(" "),c=b+["ngl"],d=document.createElement("input");d.type="file";d.multiple=!0;d.style.display="hidden";document.body.appendChild(d);d.accept="."+b.join(",.");d.addEventListener("change",function(b){b=b.target.files;for(var c=b.length,d=0;d<c;++d)a.loadFile(b[d],{asTrajectory:f,firstModelOnly:g,cAlphaOnly:h})},!1);var e=(new NGL.ExportImageWidget(a)).setDisplay("none").attach(),
f=!1,g=!1,h=!1,b=UI.MenubarHelper.createOption,l=UI.MenubarHelper.createInput,k=UI.MenubarHelper.createCheckbox,m=UI.MenubarHelper.createDivider,b=[b("Open...",function(){d.click()}),b("Import...",function(){var b=new NGL.DirectoryListingWidget(a,"Import file",c,function(d){var e=d.path.split(".").pop().toLowerCase();-1!==c.indexOf(e)?a.loadFile(d.path,{asTrajectory:f,firstModelOnly:g,cAlphaOnly:h}):NGL.log("unknown filetype: "+e);b.dispose()});b.setOpacity("0.9").setLeft("50px").setTop("80px").attach()}),
l("PDB",function(b){13===b.keyCode&&(a.loadFile("rcsb://"+b.target.value,{asTrajectory:f,firstModelOnly:g,cAlphaOnly:h}),b.target.value="")}),k("asTrajectory",!1,function(a){f=a.target.checked}),k("firstModelOnly",!1,function(a){g=a.target.checked}),k("cAlphaOnly",!1,function(a){h=a.target.checked}),m(),b("Screenshot",function(){a.viewer.screenshot({factor:1,type:"image/png",quality:1,antialias:!0,transparent:!1,trim:!1})},"camera"),b("Export image...",function(){e.setOpacity("0.9").setLeft("50px").setTop("80px").setDisplay("block")})],
b=UI.MenubarHelper.createOptionsPanel(b);return UI.MenubarHelper.createMenuContainer("File",b)};
NGL.MenubarViewWidget=function(a){var b=UI.MenubarHelper.createOption,c=UI.MenubarHelper.createDivider,b=[b("Light theme",function(){document.getElementById("theme").href="../css/light.css";a.viewer.setBackground("white")}),b("Dark theme",function(){document.getElementById("theme").href="../css/dark.css";a.viewer.setBackground("black")}),c(),b("Full screen",function(){var a=document.body;a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?
a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen()},"expand"),b("Center",function(){a.centerView()},"bullseye"),c(),b("Orientation",function(){window.prompt("Orientation",JSON.stringify(a.viewer.getOrientation()))})],b=UI.MenubarHelper.createOptionsPanel(b);return UI.MenubarHelper.createMenuContainer("View",b)};
NGL.MenubarExamplesWidget=function(a){var b=UI.MenubarHelper.createOption,c=UI.MenubarHelper.createDivider,d=[];Object.keys(NGL.Examples.data).forEach(function(e){"__divider__"===e?d.push(c()):"_"!==e.charAt(0)&&d.push(b(e,function(){NGL.Examples.load(e,a)}))});var e=UI.MenubarHelper.createOptionsPanel(d);return UI.MenubarHelper.createMenuContainer("Examples",e)};
NGL.MenubarHelpWidget=function(a){function b(){d.setOpacity("0.9").setLeft("50px").setTop("80px").setDisplay("block")}var c=(new NGL.PreferencesWidget(a)).setDisplay("none").attach(),d=(new NGL.OverviewWidget(a)).setDisplay("none").attach();a.preferences.getKey("overview")&&b();a=UI.MenubarHelper.createOption;var e=UI.MenubarHelper.createDivider;a=[a("Overview",b),a("Documentation",function(){window.open("../doc/index.html","_blank")}),e(),a("Unittests",function(){window.open("../test/unit/unittests.html",
"_blank")}),a("Benchmarks",function(){window.open("../test/bench/benchmarks.html","_blank")}),e(),a("Prefereces",function(){c.setOpacity("0.9").setLeft("50px").setTop("80px").setDisplay("block")},"sliders")];a=UI.MenubarHelper.createOptionsPanel(a);return UI.MenubarHelper.createMenuContainer("Help",a)};
NGL.OverviewWidget=function(a){function b(a,b){var c=new UI.Panel,d=(new UI.Icon(a)).setWidth("20px").setFloat("left"),f=(new UI.Text(b)).setDisplay("inline").setMarginLeft("5px");c.setMarginLeft("20px").add(d,f);e.add(c)}var c=new UI.OverlayPanel,d=(new UI.Panel).setBorderBottom("1px solid #555").setHeight("25px"),e=(new UI.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setMaxWidth("600px").setOverflow("auto");d.add((new UI.Text("NGL Viewer")).setFontStyle("italic"),new UI.Html("&nbsp;&mdash;&nbsp;Overview"));
d.add((new UI.Icon("times")).setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick(function(){c.setDisplay("none")}));c.add(d);c.add(e);e.add((new UI.Panel).add(new UI.Html("To load a new structure use the <i>File</i> menu in the top left via drag'n'drop."))).add(new UI.Break);e.add((new UI.Panel).add(new UI.Text("A number of clickable icons provide common actions. Most icons can be clicked on, just try it or hover the mouse pointer over it to see a tooltip."))).add(new UI.Break);b("eye",
"Controls the visibility of a component.");b("trash-o","Deletes a component. Note that a second click is required to confirm the action.");b("bullseye","Centers a component.");b("bars","Opens a menu with further options.");b("square","Opens a menu with coloring options.");b("filter","Indicates atom-selection input fields.");e.add(new UI.Text("Mouse controls")).add(new UI.Html("<ul><li>Left button hold and move to rotate camera around center.</li><li>Left button click to pick atom.</li><li>Middle button hold and move to zoom camera in and out.</li><li>Middle button click to center camera on atom.</li><li>Right button hold and move to translate camera in the screen plane.</li></ul>"));
e.add((new UI.Panel).add(new UI.Html("For more information please visit the <a href='../doc/index.html' target='_blank'>documentation pages</a>.")));var d=a.preferences.getKey("overview"),f=(new UI.Checkbox(d)).onClick(function(){a.preferences.setKey("overview",f.getValue())});e.add((new UI.HorizontalRule).setBorderTop("1px solid #555").setMarginTop("15px")).add((new UI.Panel).add(f,(new UI.Text("Show on startup. Always available from Menu > Help > Overview.")).setMarginLeft("5px")));return c};
NGL.PreferencesWidget=function(a){function b(a,b){e.add((new UI.Text(a)).setWidth("80px")).add(b||new UI.Panel).add(new UI.Break)}var c=a.preferences,d=new UI.OverlayPanel;a=(new UI.Panel).setBorderBottom("1px solid #555").setHeight("25px");var e=(new UI.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setOverflow("auto");a.add(new UI.Text("Preferences"));a.add((new UI.Icon("times")).setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick(function(){d.setDisplay("none")}));
d.add(a);d.add(e);var f=(new UI.Select).setOptions({dark:"dark",light:"light"}).setValue(c.getKey("theme")).onChange(function(){c.setTheme(f.getValue())}),g=(new UI.Select).setOptions({low:"low",medium:"medium",high:"high"}).setValue(c.getKey("quality")).onChange(function(){c.setQuality(g.getValue())}),h=(new UI.Checkbox).setValue(c.getKey("impostor")).onChange(function(){c.setImpostor(h.getValue())});b("theme",f);b("quality",g);b("impostor",h);return d};
NGL.ExportImageWidget=function(a){function b(a,b){e.add((new UI.Text(a)).setWidth("80px")).add(b||new UI.Panel).add(new UI.Break)}var c=new UI.OverlayPanel,d=(new UI.Panel).setBorderBottom("1px solid #555").setHeight("25px"),e=(new UI.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setOverflow("auto");d.add(new UI.Text("Image export"));d.add((new UI.Icon("times")).setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick(function(){c.setDisplay("none")}));c.add(d);
c.add(e);var f=(new UI.Select).setOptions({1:"1x",2:"2x",3:"3x",4:"4x",5:"5x",6:"6x",7:"7x",8:"8x",9:"9x",10:"10x"}).setValue("4");(new UI.Select).setOptions({"image/png":"PNG","image/jpeg":"JPEG"}).setValue("image/png");(new UI.Select).setOptions({"0.1":"0.1","0.2":"0.2","0.3":"0.3","0.4":"0.4","0.5":"0.5","0.6":"0.6","0.7":"0.7","0.8":"0.8","0.9":"0.9","1.0":"1.0"}).setValue("1.0");var g=(new UI.Checkbox).setValue(!0),h=(new UI.Checkbox).setValue(!1),l=(new UI.Checkbox).setValue(!1),k=(new UI.Progress).setDisplay("none"),
m=(new UI.Button("export")).onClick(function(){m.setDisplay("none");k.setDisplay("inline-block");setTimeout(function(){a.exportImage(parseInt(f.getValue()),g.getValue(),h.getValue(),l.getValue(),function(a,b,c){1===a&&k.setMax(b);a>=b?k.setIndeterminate():k.setValue(a);c&&(k.setDisplay("none"),m.setDisplay("inline-block"))})},50)});b("scale",f);b("antialias",g);b("transparent",h);b("trim",l);e.add(new UI.Break,m,k);return c};
NGL.SidebarWidget=function(a){var b=a.signals,c=new UI.Panel,d=(new UI.Panel).setClass("Content"),e=[],f=[];b.componentAdded.add(function(b){var c;if(b instanceof NGL.StructureComponent)c=new NGL.StructureComponentWidget(b,a);else if(b instanceof NGL.SurfaceComponent)c=new NGL.SurfaceComponentWidget(b,a);else if(b instanceof NGL.ScriptComponent)c=new NGL.ScriptComponentWidget(b,a);else if(b instanceof NGL.Component)c=new NGL.ComponentWidget(b,a);else{NGL.warn("NGL.SidebarWidget: component type unknown",
b);return}d.add(c);e.push(b);f.push(c)});b.componentRemoved.add(function(a){a=e.indexOf(a);-1!==a&&(f[a].dispose(),e.splice(a,1),f.splice(a,1))});var b=(new UI.Icon("plus-square")).setTitle("expand all").setCursor("pointer").onClick(function(){f.forEach(function(a){a.expand()})}),g=(new UI.Icon("minus-square")).setTitle("collapse all").setCursor("pointer").setMarginLeft("10px").onClick(function(){f.forEach(function(a){a.collapse()})}),h=(new UI.Icon("bullseye")).setTitle("center all").setCursor("pointer").setMarginLeft("10px").onClick(function(){a.centerView()}),
l=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){a.removeAllComponents()}),k=(new UI.PopupMenu("cogs","Settings","window")).setIconTitle("settings").setMarginLeft("10px"),m=(new UI.Panel).setDisplay("inline").add((new UI.Icon("spinner")).addClass("spin").setMarginLeft("45px"));a.tasks.signals.countChanged.add(function(a,b){if(0<b)s.add(m);else try{s.remove(m)}catch(c){}});var r=(new UI.Range(1,100,a.viewer.params.clipNear,1)).onInput(function(){a.viewer.setClip(r.getValue(),
n.getValue())}),n=(new UI.Range(1,100,a.viewer.params.clipFar,1)).onInput(function(){a.viewer.setClip(r.getValue(),n.getValue())}),q=(new UI.Range(1,100,a.viewer.params.clipDist,1)).onInput(function(){a.viewer.params.clipDist=q.getValue();a.viewer.requestRender()}),t=(new UI.Range(1,100,a.viewer.params.fogNear,1)).onInput(function(){a.viewer.setFog(null,null,t.getValue(),p.getValue())}),p=(new UI.Range(1,100,a.viewer.params.fogFar,1)).onInput(function(){a.viewer.setFog(null,null,t.getValue(),p.getValue())});
k.addEntry("clip near",r).addEntry("clip far",n).addEntry("clip distance",q).addEntry("fog near",t).addEntry("fog far",p);var s=(new UI.Panel).setClass("Panel Sticky").add(b,g,h,l,k);c.add(s,d);return c};
NGL.ComponentWidget=function(a,b){var c=a.signals,d=new UI.CollapsibleIconPanel("file");c.requestGuiVisibility.add(function(a){d.setCollapsed(!a)});c.statusChanged.add(function(b){b={404:"Error: file not found"}[a.status]||a.status;d.setCollapsed(!1);d.add((new UI.Text(b)).setMarginLeft("20px").setWidth("200px").setWordWrap("break-word"));d.removeStatic(e);d.addStatic(f)});var c=(new UI.EllipsisText(NGL.unicodeHelper(a.name))).setWidth("100px"),e=(new UI.Panel).setDisplay("inline").add((new UI.Icon("spinner")).addClass("spin").setMarginLeft("25px")),
f=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){b.removeComponent(a)});d.addStatic(c,e);return d};
NGL.StructureComponentWidget=function(a,b){function c(){var c={"":"[ structure ]"};b.eachComponent(function(b,d){b!==a&&(c[d]=NGL.unicodeHelper(b.name))},NGL.StructureComponent);m.setOptions(c)}var d=a.signals,e=new UI.CollapsibleIconPanel("file"),f=new UI.Panel,g=new UI.Panel;d.requestGuiVisibility.add(function(a){e.setCollapsed(!a)});d.representationAdded.add(function(a){f.add(new NGL.RepresentationComponentWidget(a,b))});d.trajectoryAdded.add(function(a){g.add(new NGL.TrajectoryComponentWidget(a,
b))});e.add((new UI.SelectionPanel(a.selection)).setMarginLeft("20px").setInputWidth("214px"));var d=(new UI.Button("export")).onClick(function(){var b=new Blob([a.structure.toPdb()],{type:"text/plain"});NGL.download(b,"structure.pdb");q.setMenuDisplay("none")}),h=(new UI.Select).setColor("#444").setOptions(function(){var a={"":"[ add ]"},b;for(b in NGL.representationTypes)a[b]=b;return a}()).onChange(function(){a.addRepresentation(h.getValue());h.setValue("");q.setMenuDisplay("none")}),l=(new UI.Select).setColor("#444").setOptions(function(){var b=
{__AU:"AU"};Object.keys(a.structure.biomolDict).forEach(function(a){b[a]=a});return b}()).setValue(a.structure.defaultAssembly).onChange(function(){a.structure.setDefaultAssembly(l.getValue());a.rebuildRepresentations();q.setMenuDisplay("none")}),k=(new UI.Button("import")).onClick(function(){q.setMenuDisplay("none");var c=["xtc","trr","dcd","netcdf","nc"],d=new NGL.DirectoryListingWidget(b,"Import trajectory",c,function(b){var e=b.path.split(".").pop().toLowerCase();-1!==c.indexOf(e)?(NGL.log(b),
a.addTrajectory(b.path),d.dispose()):NGL.log("unknown trajectory type: "+e)});d.setOpacity("0.9").setLeft("50px").setTop("80px").attach()});b.signals.componentAdded.add(c);b.signals.componentRemoved.add(c);var m=(new UI.Select).setColor("#444").onChange(function(){a.superpose(b.compList[m.getValue()],!0);a.centerView();m.setValue("");q.setMenuDisplay("none")});c();var r=(new UI.Button("calculate")).onClick(function(){a.structure.autoSS();a.rebuildRepresentations();q.setMenuDisplay("none")}),n=(new UI.Button("duplicate")).onClick(function(){b.addComponent(new NGL.StructureComponent(b,
a.structure.clone(),{}));q.setMenuDisplay("none")}),q=(new UI.ComponentPanel(a)).setDisplay("inline-block").setMargin("0px").addMenuEntry("PDB file",d).addMenuEntry("Representation",h).addMenuEntry("Assembly",l).addMenuEntry("Trajectory",k).addMenuEntry("Superpose",m).addMenuEntry("SS",r).addMenuEntry("Structure",n).addMenuEntry("File",(new UI.Text(a.structure.path)).setMaxWidth("100px").setWordWrap("break-word"));e.addStatic(q).add(g).add(f);return e};
NGL.SurfaceComponentWidget=function(a,b){var c=a.signals,d=new UI.CollapsibleIconPanel("file"),e=new UI.Panel;c.requestGuiVisibility.add(function(a){d.setCollapsed(!a)});c.representationAdded.add(function(a){e.add(new NGL.RepresentationComponentWidget(a,b))});var f=(new UI.Select).setColor("#444").setOptions({"":"[ add ]",surface:"surface",dot:"dot"}).onChange(function(){a.addRepresentation(f.getValue());f.setValue("");g.setMenuDisplay("none")}),g=(new UI.ComponentPanel(a)).setDisplay("inline-block").setMargin("0px").addMenuEntry("Representation",
f).addMenuEntry("File",(new UI.Text(a.surface.path)).setMaxWidth("100px").setWordWrap("break-word"));d.addStatic(g).add(e);return d};
NGL.ScriptComponentWidget=function(a,b){var c=a.signals,d=new UI.CollapsibleIconPanel("file"),e=(new UI.Panel).setMarginLeft("20px");c.requestGuiVisibility.add(function(a){d.setCollapsed(!a)});c.nameChanged.add(function(a){g.setValue(NGL.unicodeHelper(a))});c.statusChanged.add(function(a){"finished"===a&&(d.removeStatic(h),d.addStatic(f))});a.script.signals.elementAdded.add(function(a){e.add.apply(e,a)});var f=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){b.removeComponent(a)}),
g=(new UI.EllipsisText(NGL.unicodeHelper(a.name))).setWidth("100px"),h=(new UI.Icon("spinner")).addClass("spin").setMarginLeft("25px");d.addStatic(g).addStatic(h);d.add(e);return d};
NGL.RepresentationComponentWidget=function(a,b){var c=a.signals,d=(new UI.CollapsibleIconPanel("bookmark")).setMarginLeft("20px");c.requestGuiVisibility.add(function(a){d.setCollapsed(!a)});c.visibilityChanged.add(function(a){f.setValue(a)});c.colorChanged.add(function(a){h.setValue(a)});c.nameChanged.add(function(a){e.setValue(NGL.unicodeHelper(a))});c.disposed.add(function(){l.dispose();h.dispose();d.dispose()});var e=(new UI.EllipsisText(NGL.unicodeHelper(a.name))).setWidth("80px"),f=(new UI.ToggleIcon(a.visible,
"eye","eye-slash")).setTitle("hide/show").setCursor("pointer").setMarginLeft("25px").onClick(function(){a.setVisibility(!a.visible)}),g=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){a.dispose()}),h=(new UI.ColorPopupMenu).setMarginLeft("10px").setValue(a.repr.color).onChange(function(){var b=new THREE.Color;return function(c){c=h.getScheme();"color"===c?(b.setStyle(h.getColor()),a.setColor(b.getHex())):a.setColor(c);a.viewer.requestRender()}}());a.parent instanceof NGL.SurfaceComponent&&
h.schemeSelector.setOptions({"":"",value:"value",color:"color"});d.addStatic(e).addStatic(f).addStatic(g).addStatic(h);(a.parent instanceof NGL.StructureComponent||a.parent instanceof NGL.TrajectoryComponent)&&a.repr.selection instanceof NGL.Selection&&d.add((new UI.SelectionPanel(a.repr.selection)).setMarginLeft("20px").setInputWidth("194px"));var l=(new UI.PopupMenu("bars","Representation")).setMarginLeft("45px").setEntryLabelWidth("110px");l.addEntry("type",new UI.Text(a.repr.type));Object.keys(a.repr.parameters).forEach(function(b){var d=
a.repr,e,f=d.parameters[b];if(f&&("number"===f.type||"integer"===f.type?(e="number"===f.type?(new UI.Number(parseFloat(d[b])||NaN)).setPrecision(f.precision):new UI.Integer(parseInt(d[b])||NaN),e.setRange(f.min,f.max)):"boolean"===f.type?e=new UI.Checkbox(d[b]):"text"===f.type?e=new UI.Input(d[b]):"select"===f.type?e=(new UI.Select).setWidth("").setOptions(f.options).setValue(d[b]):"button"===f.type?e=(new UI.Button(b)).onClick(function(){d[b]()}):"color"===f.type?e=(new UI.ColorPopupMenu(b)).setValue(d[b]):
"hidden"!==f.type&&NGL.warn("NGL.RepresentationComponentWidget: unknown parameter type '"+f.type+"'"),e)){c.parametersChanged.add(function(a){e.setValue(a[b])});if("color"===f.type)e.onChange(function(){var c=new THREE.Color;return function(f){f={};var g=e.getScheme();"color"===g?(c.setStyle(e.getColor()),f[b]=c.getHex()):f[b]=g;a.setParameters(f);d.viewer.requestRender()}}());else e.onChange(function(){var c={};c[b]=e.getValue();a.setParameters(c);d.viewer.requestRender()});l.addEntry(b,e)}});d.addStatic(l);
return d};
NGL.TrajectoryComponentWidget=function(a,b){function c(a){h.clear().add(k.setWidth("70px"));k.setRange(-1,a-1);r.setRange(-1,a-1);m.setValue(Math.ceil((a+1)/100));p.step=m.getValue();p.end=a}var d=a.signals,e=a.trajectory,f=(new UI.CollapsibleIconPanel("database")).setMarginLeft("20px"),g=new UI.Panel;d.representationAdded.add(function(a){g.add(new NGL.RepresentationComponentWidget(a,b))});d.disposed.add(function(){v.dispose();f.dispose()});var h=(new UI.Panel).setMarginLeft("10px").setDisplay("inline").add((new UI.Icon("spinner")).addClass("spin").setMarginRight("69px"));d.gotNumframes.add(c);
d.frameChanged.add(function(a){k.setValue(a);r.setValue(a);h.clear().add(k.setWidth("70px"))});var l=(new UI.EllipsisText(e.name)).setWidth("108px");f.addStatic(l);f.addStatic(h);var k=(new UI.Integer(-1)).setMarginLeft("5px").setWidth("70px").setRange(-1,-1).onChange(function(a){e.setFrame(k.getValue());v.setMenuDisplay("none")}),m=(new UI.Integer(1)).setWidth("30px").setRange(1,1E4).onChange(function(){p.step=m.getValue()}),l=new UI.Panel,r=(new UI.Range(-1,-1,-1,1)).setWidth("197px").setMargin("0px").setPadding("0px").setBorder("0px").onInput(function(a){a=
r.getValue();a!==e.currentFrame&&(e.player&&e.player._running?(e.setPlayer(),e.setFrame(a)):e.inProgress||e.setFrame(a))}),n=(new UI.Select).setColor("#444").setOptions({"":"none",linear:"linear",spline:"spline"}).onChange(function(){p.interpolateType=n.getValue()}),q=(new UI.Integer(5)).setWidth("30px").setRange(1,50).onChange(function(){p.interpolateStep=q.getValue()}),t=(new UI.Integer(50)).setWidth("30px").setRange(10,1E3).onChange(function(){p.timeout=t.getValue()}),p=new NGL.TrajectoryPlayer(e,
m.getValue(),t.getValue(),0,e.numframes),s=(new UI.ToggleIcon(!0,"play","pause")).setMarginRight("10px").setMarginLeft("20px").setCursor("pointer").setWidth("12px").setTitle("play").onClick(function(){p.toggle()});p.signals.startedRunning.add(function(){s.setTitle("pause").setValue(!1)});p.signals.haltedRunning.add(function(){s.setTitle("play").setValue(!0)});l.add(s);l.add(r);var y=(new UI.Select).setColor("#444").setOptions({forward:"forward",backward:"backward"}).onChange(function(){p.direction=
y.getValue()}),z=(new UI.Select).setColor("#444").setOptions({loop:"loop",once:"once"}).onChange(function(){p.mode=z.getValue()});f.add((new UI.SelectionPanel(e.selection)).setMarginLeft("20px").setInputWidth("194px"));var u=(new UI.Checkbox(e.params.centerPbc)).onChange(function(){a.setParameters({centerPbc:u.getValue()})}),w=(new UI.Checkbox(e.params.removePbc)).onChange(function(){a.setParameters({removePbc:w.getValue()})}),x=(new UI.Checkbox(e.params.superpose)).onChange(function(){a.setParameters({superpose:x.getValue()})});
d.parametersChanged.add(function(a){u.setValue(a.centerPbc);w.setValue(a.removePbc);x.setValue(a.superpose)});(new UI.Button("download")).onClick(function(){e.download(m.getValue())});var d=(new UI.Button("add")).onClick(function(){a.addRepresentation()}),A=(new UI.DisposeIcon).setDisposeFunction(function(){a.parent.removeTrajectory(a)});e.numframes&&c(e.numframes);var v=(new UI.PopupMenu("bars","Trajectory")).setMarginLeft("10px").setEntryLabelWidth("130px").addEntry("Path",d).addEntry("Center",
u).addEntry("Remove PBC",w).addEntry("Superpose",x).addEntry("Step size",m).addEntry("Interpolation type",n).addEntry("Interpolation steps",q).addEntry("Play timeout",t).addEntry("Play direction",y).addEntry("Play mode",z).addEntry("File",(new UI.Text(e.trajPath)).setMaxWidth("100px").setWordWrap("break-word")).addEntry("Dispose",A);f.addStatic(v);f.add(l);f.add(g);return f};NGL.lastUsedDirectory="";NGL.DirectoryListing=function(){this.signals={listingLoaded:new signals.Signal}};
NGL.DirectoryListing.prototype={constructor:NGL.DirectoryListing,getListing:function(a){var b=this;a=a||"";var c=new THREE.XHRLoader,d="../dir/"+a;THREE.Cache.remove(d);c.load(d,function(c){c=JSON.parse(c);b.signals.listingLoaded.dispatch(a,c)})},getFolderDict:function(a){var b={"":""},c=[];(a||"").split("/").forEach(function(a){c.push(a);b[c.join("/")]=a});return b}};
NGL.DirectoryListingWidget=function(a,b,c,d){function e(a,b,c,d,e){return(b=Math,c=b.log,d=1E3,e=c(a)/c(d)|0,a/b.pow(d,e)).toFixed(2)+String.fromCharCode(160)+(e?"kMGTPEZY"[--e]+"B":"Bytes")}var f=new NGL.DirectoryListing;a=f.signals;var g=new UI.OverlayPanel,h=(new UI.Panel).setBorderBottom("1px solid #555").setHeight("30px"),l=(new UI.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setOverflow("auto"),k=(new UI.Select).setColor("#444").setMarginLeft("20px").setWidth("").setMaxWidth("200px").setOptions(f.getFolderDict()).onChange(function(){f.getListing(k.getValue())});
h.add(new UI.Text(b||"Directoy listing"));h.add(k);h.add((new UI.Icon("times")).setCursor("pointer").setMarginLeft("20px").setFloat("right").onClick(function(){g.dispose()}));g.add(h);g.add(l);a.listingLoaded.add(function(a,b){NGL.lastUsedDirectory=a;l.clear();k.setOptions(f.getFolderDict(a)).setValue(a);b.forEach(function(a){var b=a.path.split(".").pop().toLowerCase();if(!c||a.dir||-1!==c.indexOf(b)){var g;a.dir?(b="folder-o",g=a.name):(b="file-o",g=a.name+String.fromCharCode(160)+"("+e(a.size)+
")");b=(new UI.Panel).setDisplay("block").add((new UI.Icon(b)).setWidth("20px")).add(new UI.Text(g)).onClick(function(){a.dir?f.getListing(a.path):d(a)});a.restricted&&b.add((new UI.Icon("lock")).setMarginLeft("5px"));l.add(b)}})});f.getListing(NGL.lastUsedDirectory);return g};
